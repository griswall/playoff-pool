<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hurd NFL Playoff Pool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        brand: {
                            DEFAULT: '#00d084',
                            dark: '#00a366',
                            glow: 'rgba(0, 208, 132, 0.5)'
                        },
                        surface: {
                            100: '#1e293b',
                            200: '#334155',
                            300: '#475569',
                            800: '#0f172a',
                            900: '#020617',
                        }
                    },
                    backgroundImage: {
                        'main-gradient': 'radial-gradient(circle at 50% 0%, #1e293b 0%, #020617 80%)',
                        'card-gradient': 'linear-gradient(145deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.01) 100%)',
                        'accent-gradient': 'linear-gradient(135deg, #00d084 0%, #00b371 100%)',
                    }
                }
            }
        }
    </script>

    <style>
        :root {
            --accent: #00d084;
            --accent-glow: rgba(0, 208, 132, 0.4);
        }
        
        body {
            background: #020617;
            background-image: radial-gradient(circle at 50% -20%, #1e293b 0%, #020617 60%);
            background-attachment: fixed;
            color: #f8fafc;
            min-height: 100vh;
        }

        /* Glassmorphism Utilities */
        .glass-panel {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        
        .glass-header {
            background: rgba(2, 6, 23, 0.85);
            backdrop-filter: blur(16px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* Interactive Elements */
        .nav-link {
            position: relative;
            color: #94a3b8;
            transition: all 0.3s ease;
        }
        .nav-link:hover { color: white; }
        .nav-link.active { color: var(--accent); }
        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: -24px; /* Aligns with header bottom */
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--accent);
            box-shadow: 0 -2px 10px var(--accent-glow);
            border-radius: 2px 2px 0 0;
        }

        /* Player Card Polish */
        .player-card {
            background-image: linear-gradient(145deg, rgba(30, 41, 59, 0.7) 0%, rgba(15, 23, 42, 0.8) 100%);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        .player-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
        }
        .player-card:hover:not(.player-unavailable):not(.player-drafted) {
            transform: translateY(-4px);
            border-color: var(--accent);
            box-shadow: 0 8px 24px -6px rgba(0, 0, 0, 0.5), 0 0 0 1px var(--accent-glow);
            background: rgba(30, 41, 59, 0.9);
        }
        
        .player-image {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
        }

        /* States */
        .player-drafted {
            opacity: 0.5;
            filter: grayscale(100%);
            border: 1px solid rgba(255, 255, 255, 0.05);
            background: rgba(0,0,0,0.4);
        }
        .player-drafted::after {
            content: 'DRAFTED';
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg);
            font-weight: 900;
            font-size: 1.5rem;
            color: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.1);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            pointer-events: none;
        }

        .player-unavailable {
            opacity: 0.4;
            cursor: not-allowed;
        }

        /* Animations */
        @keyframes draftFlash {
            0% { box-shadow: 0 0 0 0 var(--accent); border-color: var(--accent); background-color: rgba(0, 208, 132, 0.2); }
            100% { box-shadow: 0 0 20px 10px transparent; border-color: rgba(255,255,255,0.05); background-color: transparent; }
        }
        .draft-flash { animation: draftFlash 0.6s ease-out; }

        /* Salary Bar */
        .salary-track { background: rgba(255, 255, 255, 0.1); }
        .salary-fill {
            background: linear-gradient(90deg, var(--accent), #4ade80);
            box-shadow: 0 0 12px var(--accent-glow);
        }
        .salary-fill.over-limit { background: linear-gradient(90deg, #ef4444, #dc2626); box-shadow: 0 0 12px rgba(239, 68, 68, 0.4); }

        /* Typography Tweaks */
        .text-shadow-sm { text-shadow: 0 1px 2px rgba(0,0,0,0.5); }
        .salary-text { font-family: 'JetBrains Mono', monospace; letter-spacing: -0.5px; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.2); }

        /* Tab Handling */
        .tab-content { display: none; opacity: 0; transition: opacity 0.2s ease; }
        .tab-content.active { display: block; opacity: 1; }
        #draft-team-view.active { display: flex; }

        /* Modals */
        .modal-overlay { backdrop-filter: blur(8px); background: rgba(0,0,0,0.8); }
        .modal-box { border: 1px solid rgba(255,255,255,0.1); background: #0f172a; }

        /* Admin Link */
        .admin-link { color: #fbbf24 !important; border: 1px solid rgba(251, 191, 36, 0.3); padding: 4px 12px; border-radius: 99px; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; }
        .admin-link:hover { background: rgba(251, 191, 36, 0.1); border-color: #fbbf24; box-shadow: 0 0 10px rgba(251, 191, 36, 0.2); }
        
        /* Layout Utilities */
        .section-collapsed .player-card-grid { max-height: 0; padding-top: 0; padding-bottom: 0; opacity: 0; }
        .player-card-grid { transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); opacity: 1; }
        .collapse-icon { transition: transform 0.3s ease; }
        .section-collapsed .collapse-icon { transform: rotate(-90deg); }
        
        /* Loading */
        .loading-overlay { background: rgba(2, 6, 23, 0.9); z-index: 9999; }
        
        /* Fallback Avatar */
        .player-fallback-initial {
            display: none;
            background: linear-gradient(135deg, #334155, #1e293b);
            color: #94a3b8;
            font-family: 'Inter', sans-serif;
            font-weight: 700;
        }
        .player-fallback-initial.is-visible { display: flex; }
    </style>
</head>
<body class="antialiased selection:bg-brand selection:text-black">

    <header class="glass-header sticky top-0 z-40 transition-all duration-300">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded bg-accent-gradient flex items-center justify-center shadow-[0_0_15px_var(--accent-glow)]">
                        <svg class="w-5 h-5 text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                    </div>
                    <h1 class="text-xl md:text-2xl font-black tracking-tight text-white uppercase italic">
                        Hurd <span class="text-brand">Pool</span>
                    </h1>
                </div>

                <div class="flex items-center gap-8">
                    <nav class="hidden md:flex space-x-8">
                        <a href="#draft-team-view" id="nav-draft-team" class="nav-link active text-sm font-bold uppercase tracking-wider py-7">Draft</a>
                        <a href="#player-scores-view" id="nav-player-scores" class="nav-link text-sm font-bold uppercase tracking-wider py-7">Scores</a>
                        <a href="#standings-view" id="nav-standings" class="nav-link text-sm font-bold uppercase tracking-wider py-7">Standings</a>
                        <a href="#rules-view" id="nav-rules" class="nav-link text-sm font-bold uppercase tracking-wider py-7">Rules</a>
                        <a href="admin.html" id="nav-admin" class="nav-link admin-link hidden flex items-center gap-1">
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                            Admin
                        </a>
                    </nav>
                    
                    <div id="user-auth-section" class="flex items-center">
                        <a href="login.html" id="login-button" class="bg-white text-black hover:bg-gray-200 px-4 py-2 rounded-full text-sm font-bold transition-colors">Sign In</a>
                        
                        <div id="user-profile-section" class="hidden items-center gap-4">
                            <a href="my-teams.html" id="user-email-link" class="text-sm font-medium text-gray-400 hover:text-brand transition-colors flex items-center gap-2 group">
                                <div class="w-8 h-8 rounded-full bg-surface-200 border border-white/10 flex items-center justify-center text-xs group-hover:border-brand transition-colors">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                                </div>
                                <span id="user-email-display" class="hidden lg:inline"></span>
                            </a>
                            <button id="logout-button" class="text-xs font-bold text-gray-500 hover:text-white transition-colors uppercase tracking-wide">Logout</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <nav id="sub-header" class="sticky top-20 z-30 bg-surface-900/95 backdrop-blur border-b border-white/5"></nav>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <div id="draft-team-view" class="tab-content active flex-col xl:flex-row gap-8">
            
            <div id="player-pool-container" class="w-full xl:w-3/4 space-y-8 min-h-screen" role="region" aria-label="Available players">
                </div>

            <aside class="w-full xl:w-1/4 space-y-6 xl:sticky xl:top-32 self-start">
                <div class="glass-panel rounded-xl p-6 shadow-2xl">
                    
                    <div class="mb-8">
                        <div class="flex justify-between items-end mb-2">
                            <h3 class="text-xs font-bold uppercase text-gray-400 tracking-widest">Salary Cap</h3>
                            <span class="text-2xl font-bold text-white salary-text tracking-tighter" id="total-salary-cap">$38.5M</span>
                        </div>
                        
                        <div class="relative h-3 bg-surface-800 rounded-full overflow-hidden shadow-inner border border-white/5">
                            <div id="salary-progress-bar" class="absolute top-0 left-0 h-full salary-fill rounded-full transition-all duration-500" style="width: 0%"></div>
                        </div>
                        
                        <div class="flex justify-between mt-2 text-xs font-mono">
                            <span class="text-gray-500">SPENT: <span id="spent-amount" class="text-white">$0.0M</span></span>
                            <span class="text-brand">LEFT: <span id="remaining-salary" class="font-bold">$38.5M</span></span>
                        </div>
                    </div>

                    <div>
                        <div class="flex justify-between items-center mb-4 pb-4 border-b border-white/5">
                            <h3 class="text-xs font-bold uppercase text-gray-400 tracking-widest">Your Roster</h3>
                            <span class="bg-surface-800 border border-white/10 px-2 py-0.5 rounded text-xs font-bold text-white"><span id="roster-count">0</span>/10</span>
                        </div>
                        
                        <div id="roster-slots-container" class="space-y-2">
                            </div>
                    </div>

                    <div class="mt-8">
                        <button id="submit-team-button" disabled class="w-full bg-accent-gradient hover:brightness-110 text-black font-black text-lg py-4 rounded-lg shadow-[0_0_20px_rgba(0,208,132,0.3)] disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-none disabled:bg-none disabled:bg-surface-300 transition-all transform active:scale-95 uppercase tracking-wide">
                            Submit Team
                        </button>
                        <p id="submit-team-message" class="text-xs text-center mt-3 text-gray-500 font-medium"></p>
                    </div>
                </div>
            </aside>
        </div>

        <div id="player-scores-view" class="tab-content glass-panel p-8 rounded-xl">
            <h2 class="text-3xl font-black text-white mb-8 uppercase italic tracking-tighter">Player <span class="text-brand">Scores</span></h2>
            <div id="player-scores-list" class="space-y-12">
                </div>
        </div>

        <div id="standings-view" class="tab-content glass-panel p-8 rounded-xl">
            <h2 class="text-3xl font-black text-white mb-8 uppercase italic tracking-tighter">League <span class="text-brand">Standings</span></h2>
            <div class="overflow-x-auto rounded-lg border border-white/5">
                <table id="standings-table" class="w-full text-sm text-left">
                    <thead class="text-xs text-gray-400 uppercase bg-surface-800 border-b border-white/5">
                        <tr>
                            <th class="px-6 py-4">Rank</th>
                            <th class="px-6 py-4">Team / User</th>
                            <th class="px-6 py-4 text-right">Total Points</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-white/5"></tbody>
                </table>
            </div>
        </div>

        <div id="rules-view" class="tab-content glass-panel p-8 rounded-xl">
            <h2 class="text-3xl font-black text-white mb-8 uppercase italic tracking-tighter">Pool <span class="text-brand">Rules</span></h2>
            <div class="prose prose-invert max-w-none">
                <div class="grid md:grid-cols-2 gap-8">
                    <div class="bg-surface-800/50 p-6 rounded-lg border border-white/5">
                        <h3 class="text-xl font-bold text-brand mb-4 flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                            Draft Rules
                        </h3>
                        <ul class="space-y-2 text-gray-300 text-sm">
                            <li>Salary Cap: <span class="text-white font-mono font-bold">$38.5M</span></li>
                            <li>Roster Size: <span class="text-white font-bold">10 Players</span></li>
                            <li>Limits: Max <span class="text-white font-bold">3 players</span> per NFL team.</li>
                        </ul>
                    </div>
                    <div class="bg-surface-800/50 p-6 rounded-lg border border-white/5">
                        <h3 class="text-xl font-bold text-brand mb-4 flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
                            Roster Composition
                        </h3>
                        <ul class="grid grid-cols-2 gap-2 text-sm text-gray-300">
                            <li>1 Quarterback</li>
                            <li>3 Running Backs</li>
                            <li>3 Wide Receivers</li>
                            <li>1 Flex (RB/WR/TE)</li>
                            <li>1 D/ST</li>
                            <li>1 Kicker</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="text-center py-12 border-t border-white/5 mt-12 bg-surface-900">
        <p class="text-gray-500 text-sm font-medium">&copy; 2025 Hurd NFL Playoff Pool. All Rights Reserved.</p>
    </footer>

    <div id="alert-modal" class="modal-overlay hidden fixed inset-0 z-50 flex items-center justify-center p-4" role="dialog">
        <div class="modal-box max-w-sm w-full rounded-xl p-6 shadow-2xl transform transition-all scale-100">
            <div class="text-center">
                <div class="w-12 h-12 rounded-full bg-red-500/20 text-red-500 flex items-center justify-center mx-auto mb-4">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                </div>
                <h3 id="alert-modal-title" class="text-xl font-bold text-white mb-2">Notice</h3>
                <p id="alert-modal-message" class="text-gray-400 mb-6 leading-relaxed"></p>
                <button id="alert-modal-close-btn" class="modal-close-button w-full bg-surface-300 hover:bg-surface-200 text-white font-bold py-3 rounded-lg transition-colors">Got it</button>
            </div>
        </div>
    </div>

    <div id="prompt-modal" class="modal-overlay hidden fixed inset-0 z-50 flex items-center justify-center p-4" role="dialog">
        <div class="modal-box max-w-md w-full rounded-xl p-6 shadow-2xl border border-brand/20">
            <h3 id="prompt-modal-title" class="text-2xl font-black text-white mb-2 italic uppercase">Name Your Team</h3>
            <p id="prompt-modal-message" class="text-gray-400 mb-6">Enter a unique name for your entry.</p>
            
            <input type="text" id="prompt-modal-input" class="w-full bg-surface-800 border border-white/10 rounded-lg p-4 text-white placeholder-gray-600 focus:border-brand focus:ring-1 focus:ring-brand outline-none mb-2 font-bold text-lg" placeholder="e.g. Mahomes Depot">
            <div id="prompt-modal-error" class="hidden text-red-500 text-sm mb-4 font-medium"></div>
            
            <div class="flex justify-end gap-3 mt-6">
                <button id="prompt-modal-cancel-btn" class="prompt-cancel px-6 py-3 rounded-lg font-bold text-gray-400 hover:text-white transition-colors">Cancel</button>
                <button id="prompt-modal-confirm-btn" class="prompt-confirm bg-brand hover:bg-brand-dark text-black px-8 py-3 rounded-lg font-bold shadow-lg shadow-brand/20 transition-all">Submit Entry</button>
            </div>
        </div>
    </div>

    <div id="loading-overlay" class="loading-overlay fixed inset-0 flex flex-col items-center justify-center gap-4">
        <div class="w-12 h-12 border-4 border-surface-200 border-t-brand rounded-full animate-spin"></div>
        <span class="text-brand font-bold tracking-widest text-xs uppercase">Loading Data</span>
    </div>

    <script type="module">
        import { getSupabaseClient, checkIsAdmin, clearAdminCache } from './scripts/supabaseClient.js';

        // ==================== UI RENDER HELPERS (OVERWRITES) ====================
        
        // NOTE: This replaces the createPlayerCard function in the logic below
        // to match the new HTML structure.
        function createPlayerCard(player) {
            if (!player || !player.id) return null;

            const card = document.createElement('div');
            card.className = 'player-card group relative rounded-xl p-4 cursor-pointer select-none';
            card.dataset.playerId = String(player.id);
            card.setAttribute('role', 'button');

            // Header: Position & Team
            const header = document.createElement('div');
            header.className = 'flex justify-between items-start mb-3';
            
            const posBadge = document.createElement('span');
            posBadge.className = 'text-[10px] font-black bg-surface-800 text-gray-400 px-2 py-1 rounded uppercase tracking-wider border border-white/5 group-hover:border-brand/30 group-hover:text-white transition-colors';
            posBadge.textContent = `${player.position} â€¢ ${player.team}`;
            
            // Add status indicator dot
            const statusDot = document.createElement('div');
            statusDot.className = 'w-2 h-2 rounded-full bg-brand shadow-[0_0_8px_var(--accent)]';
            
            header.appendChild(posBadge);
            header.appendChild(statusDot);
            card.appendChild(header);

            // Content: Image & Name
            const body = document.createElement('div');
            body.className = 'flex items-center gap-4 mb-3';

            // Image Handling
            const imgContainer = document.createElement('div');
            imgContainer.className = 'relative w-12 h-12';
            
            const img = document.createElement('img');
            img.src = player.imageUrl || '';
            img.className = 'w-12 h-12 rounded-full object-cover border-2 border-surface-300 group-hover:border-brand transition-colors bg-surface-800';
            img.loading = "lazy";
            
            const fallback = document.createElement('div');
            fallback.className = 'player-fallback-initial absolute inset-0 rounded-full items-center justify-center border-2 border-surface-300 bg-surface-700 text-xs font-bold';
            fallback.textContent = (player.name?.charAt(0) || '?');

            img.onerror = () => { img.style.display='none'; fallback.classList.add('is-visible'); };
            img.onload = () => { fallback.classList.remove('is-visible'); };

            imgContainer.appendChild(img);
            imgContainer.appendChild(fallback);
            
            // Name info
            const info = document.createElement('div');
            const nameEl = document.createElement('h4');
            nameEl.className = 'font-bold text-sm text-white leading-tight group-hover:text-brand transition-colors';
            nameEl.textContent = player.name;
            
            info.appendChild(nameEl);
            body.appendChild(imgContainer);
            body.appendChild(info);
            card.appendChild(body);

            // Footer: Salary
            const footer = document.createElement('div');
            footer.className = 'flex justify-between items-center border-t border-white/5 pt-3 mt-1';
            
            const salaryLabel = document.createElement('span');
            salaryLabel.className = 'text-xs text-gray-500 font-medium';
            salaryLabel.textContent = 'Salary';

            const salaryVal = document.createElement('span');
            salaryVal.className = 'salary-text text-sm font-bold text-brand tracking-tight';
            salaryVal.textContent = formatToMillions(player.salary);

            footer.appendChild(salaryLabel);
            footer.appendChild(salaryVal);
            card.appendChild(footer);

            return card;
        }

        function renderRosterSlots() {
            if (!uiElements.rosterSlotsContainer) return;
            uiElements.rosterSlotsContainer.innerHTML = '';
            const fragment = document.createDocumentFragment();
            const slotOrder = ["QB", "RB1", "RB2", "RB3", "WR1", "WR2", "WR3", "FLEX", "DST", "K"];

            slotOrder.forEach(slotKey => {
                const playerInSlot = appState.roster[slotKey];
                const slotDiv = document.createElement('div');
                // Updated styling for roster slots
                slotDiv.className = 'flex justify-between items-center p-3 bg-surface-800/50 border border-white/5 rounded-lg text-sm transition-all hover:bg-surface-800 group';
                slotDiv.id = `roster-slot-${slotKey}`;

                if (playerInSlot) {
                    // Left side: Slot + Name
                    const left = document.createElement('div');
                    left.className = 'flex flex-col';
                    
                    const label = document.createElement('span');
                    label.className = 'text-[10px] text-gray-500 font-bold uppercase tracking-wider mb-0.5';
                    label.textContent = slotKey.replace(/\d/, ''); // Remove numbers like RB1 -> RB

                    const name = document.createElement('span');
                    name.className = 'font-bold text-white group-hover:text-brand transition-colors';
                    name.textContent = playerInSlot.name;
                    
                    left.appendChild(label);
                    left.appendChild(name);
                    slotDiv.appendChild(left);

                    // Right side: Salary + Remove X
                    const right = document.createElement('div');
                    right.className = 'flex items-center gap-3';
                    
                    const sal = document.createElement('span');
                    sal.className = 'font-mono text-xs text-gray-400';
                    sal.textContent = formatToMillions(playerInSlot.salary);
                    
                    const btn = document.createElement('button');
                    btn.className = 'text-gray-600 hover:text-red-500 transition-colors p-1';
                    btn.innerHTML = '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>';
                    btn.dataset.playerId = String(playerInSlot.id);
                    btn.dataset.slotKey = slotKey;
                    
                    btn.onclick = (e) => {
                        e.stopPropagation();
                        removePlayer(playerInSlot.id, slotKey);
                    };

                    right.appendChild(sal);
                    right.appendChild(btn);
                    slotDiv.appendChild(right);
                    
                    // Add active border
                    slotDiv.classList.add('border-brand/30', 'bg-brand/5');
                } else {
                    // Empty State
                    const label = document.createElement('span');
                    label.className = 'text-xs font-bold text-gray-600 uppercase tracking-wider';
                    label.textContent = slotKey.replace(/\d/, ''); // QB, RB, etc
                    
                    const emptyText = document.createElement('span');
                    emptyText.className = 'text-xs text-gray-700 italic';
                    emptyText.textContent = 'Empty Slot';

                    slotDiv.appendChild(label);
                    slotDiv.appendChild(emptyText);
                }
                fragment.appendChild(slotDiv);
            });
            uiElements.rosterSlotsContainer.appendChild(fragment);
        }

        function renderSubHeader() {
            if (!uiElements.subHeader) return;
            const positionOrder = Object.keys(appState.allPlayersByPosition); 
            try {
                uiElements.subHeader.innerHTML = `
                    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                        <div class="flex items-center gap-2 overflow-x-auto py-4 no-scrollbar">
                            ${positionOrder.map(posKey => `
                                <a href="#section-${posKey}" 
                                   class="flex-shrink-0 px-4 py-1.5 rounded-full text-xs font-bold uppercase tracking-wide border border-white/10 bg-surface-800 text-gray-400 hover:text-white hover:border-brand hover:bg-surface-700 transition-all">
                                   ${posKey}
                                </a>
                            `).join('')}
                        </div>
                    </div>
                `;
            } catch (error) {
                 console.error("Error rendering sub-header:", error);
            }
        }
        
        function formatToMillions(value) {
            if (typeof value !== 'number' || isNaN(value)) return '$0.0M';
            return `$${(value / 1000000).toFixed(1)}M`;
        }

        // ==================== STANDARD LOGIC (KEPT FROM ORIGINAL) ====================
        
        let supabaseClient;
        try { supabaseClient = getSupabaseClient(); } catch (e) { console.error(e); }

        const CONSTANTS = {
            INITIAL_SALARY_CAP: 38500000,
            MAX_PLAYERS_PER_TEAM: 3,
            ROSTER_SIZE: 10,
            MAX_ENTRIES_PER_USER: 4, 
            ANIMATION_DURATION: 500, 
            DEBOUNCE_DELAY: 50,     
            MAX_SALARY_PERCENTAGE: 100,
            PERFORMANCE_THRESHOLD: 100 
        };

        const appState = {
            currentUser: null,
            currentSession: null,
            currentSalarySpent: 0,
            draftedPlayers: {}, 
            roster: { QB: null, RB1: null, RB2: null, RB3: null, WR1: null, WR2: null, WR3: null, FLEX: null, DST: null, K: null },
            teamCounts: {}, 
            playersById: {}, 
            allPlayersByPosition: {},
            editingTeamId: null 
        };

        const timeouts = new Set();
        let updateUITimeout = null;

        function safeSetTimeout(callback, delay) {
            const id = setTimeout(() => {
                try { callback(); } finally { timeouts.delete(id); }
            }, delay);
            timeouts.add(id);
            return id;
        }

        function clearAllTimeouts() {
            timeouts.forEach(id => clearTimeout(id));
            timeouts.clear();
            if (updateUITimeout) clearTimeout(updateUITimeout);
        }
        window.addEventListener('beforeunload', clearAllTimeouts);

        function measurePerformance(label, fn) {
            const start = performance.now();
            let result;
            try { result = fn(); } catch (error) { console.error(error); throw error; }
            return result;
        }

        function triggerUpdateAllUI() {
            if (updateUITimeout) clearTimeout(updateUITimeout);
            updateUITimeout = safeSetTimeout(() => {
                updateSalaryUI();
                updateRosterCount();
                renderRosterSlots(); 
                updatePlayerAvailabilityInPool(); 
                checkRosterFull(); 
            }, CONSTANTS.DEBOUNCE_DELAY);
        }

        function showLoadingState(show = true) {
            const overlay = document.getElementById('loading-overlay');
            if (overlay) overlay.style.display = show ? 'flex' : 'none';
        }
        function hideLoadingState() { showLoadingState(false); }

        const TEAMS = { "BAL": { name: "Baltimore Ravens" }, "BUF": { name: "Buffalo Bills" }, "CLE": { name: "Cleveland Browns" }, "DAL": { name: "Dallas Cowboys" }, "DET": { name: "Detroit Lions" }, "GB": { name: "Green Bay Packers" }, "HOU": { name: "Houston Texans" }, "KC": { name: "Kansas City Chiefs" }, "LAR": { name: "Los Angeles Rams" }, "MIA": { name: "Miami Dolphins" }, "PHI": { name: "Philadelphia Eagles" }, "PIT": { name: "Pittsburgh Steelers" }, "SF": { name: "San Francisco 49ers" }, "TB": { name: "Tampa Bay Buccaneers" } };
        const rosterSlotConfig = { QB: { count: 1, display: "QB", slots: ["QB"] }, RB: { count: 3, display: "RB", slots: ["RB1", "RB2", "RB3"] }, WR: { count: 3, display: "WR", slots: ["WR1", "WR2", "WR3"] }, FLEX: { count: 1, display: "FLEX", slots: ["FLEX"] }, DST: { count: 1, display: "D/ST", slots: ["DST"] }, K: { count: 1, display: "K", slots: ["K"]}, TE: { count: 0, display: "TE", slots: [] } };

        const uiElements = {
            playerPoolContainer: document.getElementById('player-pool-container'),
            rosterSlotsContainer: document.getElementById('roster-slots-container'),
            remainingSalaryEl: document.getElementById('remaining-salary'),
            salaryProgressBar: document.getElementById('salary-progress-bar'),
            rosterCountEl: document.getElementById('roster-count'),
            submitTeamButton: document.getElementById('submit-team-button'),
            submitTeamMessage: document.getElementById('submit-team-message'),
            navLinks: document.querySelectorAll('.nav-link'),
            tabContents: document.querySelectorAll('.tab-content'),
            alertModal: document.getElementById('alert-modal'),
            subHeader: document.getElementById('sub-header'),
            loadingOverlay: document.getElementById('loading-overlay'),
            playerScoresList: document.getElementById('player-scores-list'),
            standingsTableBody: document.querySelector('#standings-table tbody'),
            userAuthSection: document.getElementById('user-auth-section'),
            loginButton: document.getElementById('login-button'),
            userProfileSection: document.getElementById('user-profile-section'),
            userEmailDisplay: document.getElementById('user-email-display'),
            logoutButton: document.getElementById('logout-button'),
            promptModal: document.getElementById('prompt-modal'),
            adminNavButton: document.getElementById('nav-admin')
        };

        document.addEventListener('DOMContentLoaded', () => {
            showLoadingState();
            checkUser(); 
            setupEventListeners();
        });

        function setupEventListeners() {
            uiElements.playerPoolContainer?.addEventListener('click', handlePlayerPoolClick);
            uiElements.navLinks?.forEach(link => link.addEventListener('click', handleNavLinkClick));
            
            document.getElementById('alert-modal-close-btn')?.addEventListener('click', () => uiElements.alertModal?.classList.add('hidden'));
            document.getElementById('prompt-modal-cancel-btn')?.addEventListener('click', hidePromptModal);
            document.getElementById('prompt-modal-confirm-btn')?.addEventListener('click', handleConfirmSubmission);
            
            uiElements.logoutButton?.addEventListener('click', handleLogout);
            uiElements.submitTeamButton?.addEventListener('click', handleSubmitTeamClick);
        }
        
        function initializeUI() {
            renderPlayerPool();
            renderRosterSlots();
            triggerUpdateAllUI(); 
            renderSubHeader();
        }

        async function checkUser() {
            if (!supabaseClient) { hideLoadingState(); return; }
            const { data, error } = await supabaseClient.auth.getSession();
            if (error || !data.session) {
                window.location.href = "login.html"; 
            } else {
                appState.currentUser = data.session.user;
                appState.currentSession = data.session;
                updateAuthUI(true, data.session.user.email);
                checkAdminStatus();

                const urlParams = new URLSearchParams(window.location.search);
                const teamIdToEdit = urlParams.get('edit_team_id');

                await fetchPlayersAndScores(); 

                if (teamIdToEdit) await loadTeamForEditing(teamIdToEdit);
                else hideLoadingState();
                
                renderPlayerScoresTab(); 
                fetchAndRenderStandings(); 
            }
        }

        async function checkAdminStatus() {
            const isAdmin = await checkIsAdmin(); 
            if (isAdmin) uiElements.adminNavButton?.classList.remove('hidden');
        }

        function updateAuthUI(loggedIn, email = '') {
            if (loggedIn) {
                uiElements.loginButton?.classList.add('hidden');
                uiElements.userProfileSection?.classList.remove('hidden');
                if (uiElements.userEmailDisplay) uiElements.userEmailDisplay.textContent = email;
                if (uiElements.userEmailDisplay) uiElements.userEmailDisplay.classList.remove('hidden'); // Ensure visibility
                uiElements.userProfileSection.style.display = 'flex'; // Force flex
            }
        }

        async function handleLogout() {
            showLoadingState();
            clearAdminCache();
            await supabaseClient.auth.signOut();
            window.location.href = "login.html"; 
        }

        async function fetchPlayersAndScores() {
            try {
                const [playerPromise, scoresPromise] = [
                    supabaseClient.from('players').select('*'),
                    supabaseClient.from('player_scores').select('player_id, playoff_round, points')
                ];
                const [{ data: players }, { data: scoresData }] = await Promise.all([playerPromise, scoresPromise]);

                const scoresMap = (scoresData || []).reduce((acc, score) => {
                    acc[`${score.player_id}-${score.playoff_round}`] = score.points;
                    return acc;
                }, {});

                appState.allPlayersByPosition = { QB: [], RB: [], WR: [], TE: [], DST: [], K: [] };

                players.forEach(p => {
                    const playoffScores = [
                        scoresMap[`${p.id}-WC`] || 0,
                        scoresMap[`${p.id}-DIV`] || 0,
                        scoresMap[`${p.id}-CONF`] || 0,
                        scoresMap[`${p.id}-SB`] || 0
                    ];
                    const player = {
                        ...p,
                        teamFullName: TEAMS[p.team]?.name || p.name,
                        imageUrl: p.position === 'DST' ? `https://a.espncdn.com/i/teamlogos/nfl/500/${p.id}.png` : `https://a.espncdn.com/i/headshots/nfl/players/full/${p.id}.png`,
                        playoffScores: playoffScores, 
                        totalPoints: playoffScores.reduce((sum, s) => sum + (s || 0), 0)
                    };
                    if (appState.allPlayersByPosition[player.position]) {
                        appState.allPlayersByPosition[player.position].push(player);
                        appState.playersById[player.id] = player;
                    }
                });
                initializeUI(); 
            } catch (error) { console.error(error); } 
        }

        async function loadTeamForEditing(teamId) {
            showLoadingState();
            try {
                const { data: teamData, error } = await supabaseClient.from('user_teams').select(`id, team_name, user_id, team_players (roster_slot, players (id))`).eq('id', teamId).eq('user_id', appState.currentUser.id).single();
                if (error) throw error;

                resetDraftState(); 
                appState.editingTeamId = teamData.id;

                teamData.team_players.forEach(tp => {
                    const player = appState.playersById[tp.players.id];
                    if (player) {
                        const slot = tp.roster_slot;
                        appState.roster[slot] = player;
                        appState.draftedPlayers[player.id] = player;
                        appState.currentSalarySpent += player.salary;
                        appState.teamCounts[player.team] = (appState.teamCounts[player.team] || 0) + 1;
                    }
                });
                if (uiElements.submitTeamButton) {
                    uiElements.submitTeamButton.textContent = "Update Team";
                    uiElements.submitTeamButton.classList.add('bg-yellow-400', 'hover:bg-yellow-500', 'text-black'); // Styling tweaks
                }
                triggerUpdateAllUI(); 
            } catch (error) { window.location.href = "index.html"; } finally { hideLoadingState(); }
        }

        function handleSubmitTeamClick() {
            if (Object.keys(appState.draftedPlayers).length !== CONSTANTS.ROSTER_SIZE) {
                showAlertModal("Roster Incomplete", "You must draft 10 players to submit your team.");
                return;
            }
            if (appState.editingTeamId) handleConfirmSubmission();
            else showPromptModal('Name Your Team', 'Enter a name for this entry:');
        }

        async function handleConfirmSubmission() {
            let teamName;
            const nameInput = document.getElementById('prompt-modal-input');
            const errorEl = document.getElementById('prompt-modal-error');
            
            if (!appState.editingTeamId) {
                teamName = nameInput.value.trim();
                if (!teamName) {
                    errorEl.textContent = "Team name cannot be empty.";
                    errorEl.classList.remove('hidden');
                    return;
                }
            }
            
            showLoadingState();
            hidePromptModal();

            try {
                if (!appState.editingTeamId) {
                    const { count } = await supabaseClient.from('user_teams').select('*', { count: 'exact', head: true }).eq('user_id', appState.currentUser.id);
                    if (count >= CONSTANTS.MAX_ENTRIES_PER_USER) throw new Error(`Max entries reached.`);
                    
                    const { data: teamData, error } = await supabaseClient.from('user_teams').insert({ user_id: appState.currentUser.id, team_name: teamName }).select('id').single(); 
                    if (error) throw error;
                    appState.editingTeamId = teamData.id; 
                }

                const playersToInsert = Object.keys(appState.roster).filter(k => appState.roster[k]).map(k => ({ team_id: appState.editingTeamId, player_id: appState.roster[k].id, roster_slot: k }));
                
                await supabaseClient.from('team_players').delete().eq('team_id', appState.editingTeamId);
                await supabaseClient.from('team_players').insert(playersToInsert);

                showAlertModal("Success!", appState.editingTeamId ? `Team updated.` : `Team submitted.`);
                if (!window.location.search.includes('edit_team_id')) resetDraftState();
                else setTimeout(() => window.location.href = "my-teams.html", 1500);

            } catch (error) { console.error(error); showAlertModal("Error", error.message); } finally { hideLoadingState(); }
        }
        
        function resetDraftState() {
            appState.currentSalarySpent = 0;
            appState.draftedPlayers = {};
            appState.roster = { QB: null, RB1: null, RB2: null, RB3: null, WR1: null, WR2: null, WR3: null, FLEX: null, DST: null, K: null };
            appState.teamCounts = {};
            appState.editingTeamId = null; 
            
            uiElements.submitTeamButton.textContent = "Submit Team";
            if (window.location.search.includes('edit_team_id')) window.history.pushState({}, '', window.location.pathname);
            triggerUpdateAllUI(); 
        }

        function handlePlayerPoolClick(event) {
            const card = event.target.closest('.player-card');
            const header = event.target.closest('.position-group h2'); // Simplified selector
            
            if (header) {
                const section = header.parentElement;
                section.classList.toggle('section-collapsed');
                return;
            }
            if (card && !card.classList.contains('player-unavailable') && !card.classList.contains('player-drafted')) {
                draftPlayer(appState.playersById[card.dataset.playerId], card);
            }
        }

        function handleNavLinkClick(event) {
            event.preventDefault();
            const href = event.currentTarget.getAttribute('href');
            if (href.includes('.html')) { window.location.href = href; return; }
            if (href.startsWith('#')) {
                const targetId = href.substring(1);
                uiElements.navLinks.forEach(nav => nav.classList.remove('active'));
                event.currentTarget.classList.add('active');
                uiElements.tabContents.forEach(c => c.classList.toggle('active', c.id === targetId));
            }
        }

        function draftPlayer(player, cardElement) {
            if (appState.currentSalarySpent + player.salary > CONSTANTS.INITIAL_SALARY_CAP) { showAlertModal('Cap Exceeded', 'Not enough salary.'); return; }
            if ((appState.teamCounts[player.team] || 0) >= CONSTANTS.MAX_PLAYERS_PER_TEAM) { showAlertModal('Limit Reached', 'Too many players from this team.'); return; }
            
            const slot = findAvailableSlot(player.position);
            if (!slot) { showAlertModal('Position Full', 'No slot available.'); return; }

            appState.roster[slot] = player;
            appState.draftedPlayers[player.id] = player;
            appState.currentSalarySpent += player.salary;
            appState.teamCounts[player.team] = (appState.teamCounts[player.team] || 0) + 1;

            cardElement.classList.add('draft-flash');
            setTimeout(() => cardElement.classList.remove('draft-flash'), 500);
            triggerUpdateAllUI();
        }

        function findAvailableSlot(position) {
            const slots = rosterSlotConfig[position]?.slots || [];
            for (const s of slots) if (!appState.roster[s]) return s;
            if (['RB', 'WR', 'TE'].includes(position) && !appState.roster.FLEX) return "FLEX";
            return null;
        }

        function removePlayer(playerId, slotKey) {
            const player = appState.draftedPlayers[playerId];
            if (!player) return;
            appState.currentSalarySpent -= player.salary;
            appState.teamCounts[player.team]--;
            if (appState.teamCounts[player.team] <= 0) delete appState.teamCounts[player.team];
            delete appState.draftedPlayers[playerId];
            appState.roster[slotKey] = null;
            triggerUpdateAllUI();
        }

        function renderPlayerPool() {
            if (!uiElements.playerPoolContainer) return;
            uiElements.playerPoolContainer.innerHTML = '';
            ["QB", "RB", "WR", "TE", "DST", "K"].forEach(posKey => {
                const players = appState.allPlayersByPosition[posKey];
                if (players?.length > 0) {
                    const section = document.createElement('section');
                    section.id = `section-${posKey}`;
                    section.className = 'position-group mb-8';
                    
                    const header = document.createElement('h2');
                    header.className = 'text-2xl font-black text-white mb-4 flex items-center gap-3 uppercase italic tracking-tight cursor-pointer hover:text-brand transition-colors';
                    header.innerHTML = `<span>${posKey}</span><span class="h-px flex-grow bg-white/10"></span><svg class="collapse-icon w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>`;
                    
                    const grid = document.createElement('div');
                    grid.className = 'player-card-grid grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4';
                    
                    players.sort((a,b) => b.salary - a.salary).forEach(p => grid.appendChild(createPlayerCard(p)));
                    section.appendChild(header);
                    section.appendChild(grid);
                    uiElements.playerPoolContainer.appendChild(section);
                }
            });
        }

        function updatePlayerAvailabilityInPool() {
            const remainingSal = CONSTANTS.INITIAL_SALARY_CAP - appState.currentSalarySpent;
            document.querySelectorAll('.player-card').forEach(card => {
                const player = appState.playersById[card.dataset.playerId];
                if (!player) return;
                card.classList.remove('player-drafted', 'player-unavailable');
                
                if (appState.draftedPlayers[player.id]) card.classList.add('player-drafted');
                else if ((appState.teamCounts[player.team] || 0) >= CONSTANTS.MAX_PLAYERS_PER_TEAM) card.classList.add('player-unavailable');
                else if (!findAvailableSlot(player.position)) card.classList.add('player-unavailable');
                else if (player.salary > remainingSal) card.classList.add('player-unavailable');
            });
        }

        function updateSalaryUI() {
            const remaining = CONSTANTS.INITIAL_SALARY_CAP - appState.currentSalarySpent;
            const spent = appState.currentSalarySpent;
            if (uiElements.remainingSalaryEl) uiElements.remainingSalaryEl.textContent = formatToMillions(remaining);
            if (document.getElementById('spent-amount')) document.getElementById('spent-amount').textContent = formatToMillions(spent);
            
            const pct = (spent / CONSTANTS.INITIAL_SALARY_CAP) * 100;
            if (uiElements.salaryProgressBar) {
                uiElements.salaryProgressBar.style.width = `${Math.min(pct, 100)}%`;
                uiElements.salaryProgressBar.classList.toggle('over-limit', remaining < 0);
            }
        }

        function updateRosterCount() {
            uiElements.rosterCountEl.textContent = Object.keys(appState.draftedPlayers).length;
        }

        function checkRosterFull() {
            const isFull = Object.keys(appState.draftedPlayers).length === CONSTANTS.ROSTER_SIZE;
            uiElements.submitTeamButton.disabled = !isFull;
        }

        function showAlertModal(title, message) {
            document.getElementById('alert-modal-title').textContent = title;
            document.getElementById('alert-modal-message').textContent = message;
            uiElements.alertModal.classList.remove('hidden');
        }
        function showPromptModal(title, message) {
            document.getElementById('prompt-modal-title').textContent = title;
            document.getElementById('prompt-modal-message').textContent = message;
            document.getElementById('prompt-modal-input').value = '';
            document.getElementById('prompt-modal').classList.remove('hidden');
        }
        function hidePromptModal() { document.getElementById('prompt-modal').classList.add('hidden'); }

        // Render Tabs (Scores / Standings) - Simplified for brevity in this update
        function renderPlayerScoresTab() {
            const container = uiElements.playerScoresList;
            if(!container) return;
            container.innerHTML = '';
            
            ["QB", "RB", "WR", "TE", "DST", "K"].forEach(pos => {
                const players = appState.allPlayersByPosition[pos];
                if(!players?.length) return;
                
                const wrapper = document.createElement('div');
                wrapper.className = 'glass-panel p-6 rounded-xl';
                wrapper.innerHTML = `<h3 class="text-xl font-black text-brand mb-4 border-b border-white/5 pb-2">${pos}</h3>`;
                
                const table = document.createElement('table');
                table.className = 'w-full text-sm text-left text-gray-400';
                table.innerHTML = `
                    <thead class="text-xs uppercase text-gray-500"><tr><th class="py-2">Player</th><th class="text-right">Total</th></tr></thead>
                    <tbody class="divide-y divide-white/5">
                        ${players.sort((a,b)=>b.totalPoints-a.totalPoints).map(p => `
                            <tr><td class="py-2 text-white font-medium">${p.name} <span class="text-gray-600 text-xs ml-1">${p.team}</span></td><td class="text-right font-mono text-brand">${p.totalPoints.toFixed(1)}</td></tr>
                        `).join('')}
                    </tbody>
                `;
                wrapper.appendChild(table);
                container.appendChild(wrapper);
            });
        }

        async function fetchAndRenderStandings() {
            const tbody = uiElements.standingsTableBody;
            tbody.innerHTML = `<tr><td colspan="3" class="text-center py-8 text-gray-500 animate-pulse">Updating Standings...</td></tr>`;
            try {
                const { data } = await supabaseClient.rpc('get_standings');
                tbody.innerHTML = '';
                if(!data?.length) { tbody.innerHTML = `<tr><td colspan="3" class="text-center py-8 text-gray-600">No teams found.</td></tr>`; return; }
                
                data.forEach((team, i) => {
                    const row = tbody.insertRow();
                    row.className = i < 3 ? 'bg-white/5' : '';
                    row.innerHTML = `
                        <td class="px-6 py-4 font-mono font-bold ${i===0?'text-yellow-400':i===1?'text-gray-300':i===2?'text-orange-400':'text-gray-500'}">#${team.rank}</td>
                        <td class="px-6 py-4 font-bold text-white">${team.team_name}</td>
                        <td class="px-6 py-4 text-right font-mono font-bold text-brand">${team.total_points.toFixed(1)}</td>
                    `;
                });
            } catch(e) { console.error(e); }
        }

    </script>
</body>
</html>
